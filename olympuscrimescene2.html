<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„œìŠ¤í™íŠ¸: ì €íƒ ì‚´ì¸ì‚¬ê±´ (ì˜¤í”„ë¼ì¸)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
        .modal-content {
            background-color: #2c2c2c;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            width: 90%;
            max-width: 500px;
            border: 1px solid #444;
        }
        #room-container {
            position: relative;
            width: 100%;
            max-width: 1000px;
            margin: 20px auto;
            background: url('https://placehold.co/1000x600/3a2d1e/ffffff?text=%EC%A0%80%ED%83%9D+%EC%84%9C%EC%9E%AC+%28%EB%B0%A9+1%29') no-repeat center center;
            background-size: cover;
            height: 60vh;
            border: 2px solid #555;
            border-radius: 8px;
            overflow: hidden;
        }
        .clue-hotspot {
            position: absolute;
            width: 50px;
            height: 50px;
            background-color: rgba(255, 0, 0, 0.4);
            border: 2px dashed red;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            color: white;
            font-weight: bold;
        }
        .clue-hotspot:hover {
            background-color: rgba(255, 0, 0, 0.7);
            transform: scale(1.1);
        }
        #hotspot-knife { top: 70%; left: 25%; }
        #hotspot-note { top: 45%; left: 50%; }
        #hotspot-vial { top: 60%; left: 70%; }
        #flash-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: white;
            opacity: 0;
            z-index: 9999;
            pointer-events: none;
            transition: opacity 0.1s ease-out;
        }
        #flash-overlay.flash {
            opacity: 0.9;
        }
        .gallery-photo {
            border: 2px solid #ccc;
            border-radius: 8px;
            background: #444;
        }
        /* Custom select-wrapper */
        .select-wrapper {
            position: relative;
        }
        .select-wrapper::after {
            content: 'â–¼';
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            pointer-events: none;
        }
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <div id="flash-overlay"></div>

    <div id="app-container" class="w-full max-w-4xl p-6">

        <!-- 1. ê²Œì„ ì‹œì‘ í™”ë©´ (Firebase ì¸ì¦ ëŒ€ì²´) -->
        <div id="start-screen">
            <h1 class="text-4xl font-bold text-center mb-6 text-red-400">ì„œìŠ¤í™íŠ¸: ì €íƒ ì‚´ì¸ì‚¬ê±´</h1>
            <div class="bg-gray-800 p-6 rounded-lg shadow-xl">
                <input type="text" id="player-name-input" placeholder="ë‹¹ì‹ ì˜ ì´ë¦„ (ìš©ì˜ìëª…)..." class="w-full p-3 rounded-md bg-gray-700 text-white placeholder-gray-400 mb-4 focus:outline-none focus:ring-2 focus:ring-red-400">
                
                <div class="select-wrapper mb-4">
                    <select id="role-select" class="w-full p-3 rounded-md bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-red-400">
                        <option value="">ë‹¹ì‹ ì˜ ì—­í• (ìš©ì˜ì)ì„ ì„ íƒí•˜ì„¸ìš”...</option>
                        <!-- JSë¡œ ì—­í•  ë™ì  ë¡œë“œ -->
                    </select>
                </div>
                
                <!-- (â˜…) ì¶”ê°€: ì—­í•  ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ -->
                <input type="password" id="role-password-input" placeholder="ì„ íƒí•œ ì—­í• ì˜ ë¹„ë°€ë²ˆí˜¸..." class="w-full p-3 rounded-md bg-gray-700 text-white placeholder-gray-400 mb-4 focus:outline-none focus:ring-2 focus:ring-red-400">

                <button id="start-game-btn" class="w-full p-3 bg-red-600 hover:bg-red-700 rounded-md font-bold text-white transition-colors">
                    ì‚¬ê±´ ì¡°ì‚¬ ì‹œì‘
                </button>
            </div>
            <div class="text-center mt-4 text-sm text-gray-400">
                ì´ ê²Œì„ì€ ì˜¤í”„ë¼ì¸ ë²„ì „ì…ë‹ˆë‹¤.<br>
                ìˆ˜ì§‘í•œ ì¦ê±°(ì‚¬ì§„)ëŠ” ì´ ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.
            </div>
        </div>

        <!-- 2. ê²Œì„ ì§„í–‰ í™”ë©´ (ì°¸ì—¬ í›„ ë³´ì„) -->
        <div id="game-screen" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-2xl font-bold text-red-400">ì €íƒ ì„œì¬</h1>
                <!-- (â˜…) ìˆ˜ì •: íƒ€ì´ë¨¸ ë° í”Œë ˆì´ì–´ ì •ë³´ í‘œì‹œ ì˜ì—­ -->
                <div class="text-right">
                    <div id="timer-display" class="text-3xl font-bold text-yellow-400">00:00</div>
                    <span class="text-sm">í”Œë ˆì´ì–´: <strong id="display-player-name" class="text-blue-300"></strong></span>
                </div>
            </div>

            <!-- í˜„ì¬ ì°¸ì—¬ì ëª©ë¡ (ì œê±°ë¨) -->

            <!-- ë°© (ì¡°ì‚¬ ì˜ì—­) -->
            <div id="room-container">
                <!-- ë‹¨ì„œ í•«ìŠ¤íŒŸ -->
                <div id="hotspot-knife" class="clue-hotspot" data-clue="knife">
                    <span title="ë°”ë‹¥ì— ë–¨ì–´ì§„ ê²ƒ">?</span>
                </div>
                <div id="hotspot-note" class="clue-hotspot" data-clue="note">
                    <span title="ì±…ìƒ ìœ„ì— ë†“ì¸ ê²ƒ">?</span>
                </div>
                <div id="hotspot-vial" class="clue-hotspot" data-clue="vial">
                    <span title="ì±…ì¥ í‹ˆìƒˆì— ìˆ¨ê²¨ì§„ ê²ƒ">?</span>
                </div>
            </div>

            <!-- í•˜ë‹¨ ë²„íŠ¼ ë©”ë‰´ -->
            <div class="flex justify-center gap-4 mt-6">
                <button id="my-info-btn" class="py-3 px-6 bg-blue-600 hover:bg-blue-700 rounded-lg font-bold shadow-lg transition-colors">ë‚´ ë¹„ë°€ì •ë³´ í™•ì¸</button>
                <button id="gallery-btn" class="py-3 px-6 bg-green-600 hover:bg-green-700 rounded-lg font-bold shadow-lg transition-colors">ì‚¬ì§„ì²© ë³´ê¸°</button>
                <!-- (â˜…) ì‚­ì œ: 'ë²”ì¸ íˆ¬í‘œí•˜ê¸°' ë²„íŠ¼
                <button id="vote-btn" class="py-3 px-6 bg-red-600 hover:bg-red-700 rounded-lg font-bold shadow-lg transition-colors">ë²”ì¸ íˆ¬í‘œí•˜ê¸°</button>
                -->
            </div>
        </div>

        <!-- 3. ëª¨ë‹¬ ì°½ë“¤ -->

        <!-- ë‹¨ì„œ í™•ì¸ ë° ì‚¬ì§„ ì°ê¸° ëª¨ë‹¬ -->
        <div id="clue-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h2 id="clue-title" class="text-2xl font-bold mb-4"></h2>
                <img id="clue-image" src="" alt="ë‹¨ì„œ ì´ë¯¸ì§€" class="w-full rounded-lg mb-4 border-2 border-gray-500">
                <p id="clue-desc" class="mb-6"></p>
                <div class="flex gap-4">
                    <button id="take-photo-btn" class="w-full py-3 bg-green-600 hover:bg-green-700 rounded-lg font-bold transition-colors">ğŸ“¸ ì‚¬ì§„ ì°ê¸°</button>
                    <button data-close="clue-modal" class="w-1/3 py-3 bg-gray-600 hover:bg-gray-700 rounded-lg font-bold transition-colors">ë‹«ê¸°</button>
                </div>
            </div>
        </div>

        <!-- ì‚¬ì§„ì²© (ìˆ˜ì§‘í•œ ì¦ê±°) ëª¨ë‹¬ -->
        <div id="gallery-modal" class="modal-overlay hidden">
            <div class="modal-content max-w-2xl">
                <h2 class="text-2xl font-bold mb-6">ë‚´ ì‚¬ì§„ì²© (ìˆ˜ì§‘í•œ ì¦ê±°)</h2>
                <div id="gallery-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-[60vh] overflow-y-auto pr-2">
                    <!-- JSë¡œ ë™ì  ìƒì„± -->
                </div>
                <!-- (â˜…) ìˆ˜ì •: 'gallery-empty' ë©”ì‹œì§€ë¥¼ 'gallery-grid' ë°–ìœ¼ë¡œ ì´ë™ì‹œì¼°ìŠµë‹ˆë‹¤. -->
                <!-- ë˜í•œ, ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê²¨(hidden)ë‘ê³  JSê°€ ì œì–´í•˜ë„ë¡ í•©ë‹ˆë‹¤. -->
                <p id="gallery-empty" class="text-gray-400 mt-4 text-center hidden">ì•„ì§ ìˆ˜ì§‘í•œ ì¦ê±° ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                <button data-close="gallery-modal" class="w-full mt-6 py-3 bg-gray-600 hover:bg-gray-700 rounded-lg font-bold transition-colors">ë‹«ê¸°</button>
            </div>
        </div>

        <!-- ë‚´ ë¹„ë°€ ì •ë³´ ëª¨ë‹¬ -->
        <div id="my-info-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h2 class="text-2xl font-bold mb-4 text-yellow-400">ë‚˜ì˜ ë¹„ë°€ ì •ë³´</h2>
                <p class="text-lg mb-2">ë‹¹ì‹ ì€ <strong id="my-role" class="text-blue-300"></strong>ì…ë‹ˆë‹¤.</p>
                <div class="bg-gray-700 p-4 rounded-lg">
                    <p id="my-alibi" class="text-gray-200"></p>
                </div>
                <button data-close="my-info-modal" class="w-full mt-6 py-3 bg-gray-600 hover:bg-gray-700 rounded-lg font-bold transition-colors">ë‹«ê¸°</button>
            </div>
        </div>

        <!-- 4. ì•Œë¦¼ ëª¨ë‹¬ (Alert ëŒ€ì²´) -->
        <div id="alert-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h2 id="alert-title" class="text-2xl font-bold mb-4 text-yellow-400">ì•Œë¦¼</h2>
                <p id="alert-message" class="text-gray-200 mb-6"></p>
                <button id="alert-close-btn" class="w-full py-3 bg-gray-600 hover:bg-gray-700 rounded-lg font-bold transition-colors">í™•ì¸</button>
            </div>
        </div>

        <!-- (â˜…) ì¶”ê°€: 5. í˜ì´ì¦ˆ ì‹œì‘ ëª¨ë‹¬ -->
        <div id="phase-modal" class="modal-overlay hidden">
            <div class="modal-content text-center">
                <h2 id="phase-title" class="text-3xl font-bold mb-4 text-green-400"></h2>
                <p id="phase-desc" class="text-lg mb-6"></p>
                <button id="start-phase-btn" class="w-full py-3 bg-green-600 hover:bg-green-700 rounded-lg font-bold transition-colors">ì¡°ì‚¬ ì‹œì‘</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK (ì œê±°ë¨) -->

    <script type="module">
        // Firebase ê´€ë ¨ import ëª¨ë‘ ì œê±°

        // --- ê²Œì„ ì„¤ì • (ë™ì¼) ---
        const CLUE_DEFINITIONS = {
            'knife': {
                name: "í”¼ ë¬»ì€ ì£¼ë°©ìš© ì¹¼",
                desc: "ì„œì¬ ë°”ë‹¥ì˜ ì¹´í« ë°‘ì—ì„œ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì†ì¡ì´ê°€ ê¹¨ë—í•˜ê²Œ ë‹¦ì—¬ìˆì§€ë§Œ, ì¹¼ë‚ ì—ëŠ” ë¯¸ì„¸í•œ í˜ˆí”ì´ ë¬»ì–´ìˆìŠµë‹ˆë‹¤.",
                img: "https://placehold.co/400x250/5a2d1a/ffffff?text=%ED%94%BC+%EB%AC%BB%EC%9D%80+%EC%B9%BC"
            },
            'note': {
                name: "ì°¢ì–´ì§„ ìª½ì§€",
                desc: "ì±…ìƒ ìœ„ ì‰í¬ë³‘ ë°›ì¹¨ ì•„ë˜ì— ìˆ¨ê²¨ì ¸ ìˆì—ˆìŠµë‹ˆë‹¤. '...ì˜¤ëŠ˜ ë°¤, ëª¨ë“  ê²ƒì„ ëë‚´ê² ì–´.'ë¼ëŠ” ë¬¸êµ¬ê°€ ì í˜€ìˆìŠµë‹ˆë‹¤.",
                img: "https://placehold.co/400x250/a1a1a1/000000?text=%EC%B0%A2%EC%96%B4%EC%A7%84+%EC%AA%BD%EC%A7%80"
            },
            'vial': {
                name: "ìˆ˜ìƒí•œ ì•½ë³‘",
                desc: "ì±…ì¥ í‹ˆìƒˆì— ë¼ì–´ìˆë˜ ì‘ì€ ìœ ë¦¬ë³‘ì…ë‹ˆë‹¤. ê°•í•œ ì•„ëª¬ë“œ í–¥(ì²­ì‚°ê°€ë¦¬)ì´ ë‚˜ë©°, ë¼ë²¨ì´ ëœ¯ê²¨ì ¸ ìˆìŠµë‹ˆë‹¤.",
                img: "https://placehold.co/400x250/3a5a7a/ffffff?text=%EC%88%98%EC%83%81%ED%95%9C+%EC%95%BD%EB%B3%91"
            }
        };

        // (â˜…) ìˆ˜ì •: ROLE_DATA êµ¬ì¡° ë³€ê²½ (alibi, password)
        const ROLE_DATA = {
            "ì§‘ì‚¬": {
                alibi: "ë‹¹ì‹ ì€ ì´ ì €íƒì˜ ì§‘ì‚¬ì…ë‹ˆë‹¤. ì‚¬ê±´ ë‹¹ì¼ ë°¤, ë‹¹ì‹ ì€ 'ì£¼ì¸ë‹˜ì˜ ì„œì¬ì—ì„œ í° ì†Œë¦¬ê°€ ë‚˜ëŠ” ê²ƒì„ ë“¤ì—ˆì§€ë§Œ, ë¬´ì„œì›Œì„œ ë“¤ì–´ê°€ ë³´ì§€ ëª»í–ˆë‹¤'ê³  ì¦ì–¸í•´ì•¼ í•©ë‹ˆë‹¤. (ë¹„ë°€: ë‹¹ì‹ ì€ ì‚¬ì‹¤ ì£¼ì¸ë‹˜ì´ ëˆ„êµ°ê°€ì™€ ë‹¤íˆ¬ëŠ” ëª©ì†Œë¦¬ë¥¼ ë“¤ì—ˆìŠµë‹ˆë‹¤.)",
                password: "pass1" // (â˜…) ì‹¤ì œ ê²Œì„ ë°°í¬ ì‹œ ì´ ì•”í˜¸ë¥¼ ë³€ê²½í•˜ì„¸ìš”.
            },
            "ìƒì†ë…€": {
                alibi: "ë‹¹ì‹ ì€ í”¼í•´ìì˜ ìœ ì¼í•œ ìƒì†ë…€ì…ë‹ˆë‹¤. ë‹¹ì‹ ì€ 'ì‚¬ê±´ ì¶”ì • ì‹œê°, ì •ì›ì—ì„œ ì‚°ì±… ì¤‘ì´ì—ˆë‹¤'ê³  ì¦ì–¸í•´ì•¼ í•©ë‹ˆë‹¤. (ë¹„ë°€: ë‹¹ì‹ ì€ ìµœê·¼ í”¼í•´ìì™€ ìœ ì‚° ë¬¸ì œë¡œ í¬ê²Œ ë‹¤íœœìŠµë‹ˆë‹¤.)",
                password: "pass2" // (â˜…) ì‹¤ì œ ê²Œì„ ë°°í¬ ì‹œ ì´ ì•”í˜¸ë¥¼ ë³€ê²½í•˜ì„¸ìš”.
            },
            "ì˜ì‚¬": {
                alibi: "ë‹¹ì‹ ì€ í”¼í•´ìì˜ ì£¼ì¹˜ì˜ì…ë‹ˆë‹¤. ë‹¹ì‹ ì€ 'ì‚¬ê¹€ ë‹¹ì¼, í”¼í•´ìì—ê²Œ ì •ê¸° ê²€ì§„ì„ í–ˆìœ¼ë©°, ê±´ê°•ì€ ì–‘í˜¸í–ˆë‹¤'ê³  ì¦ì–¸í•´ì•¼ í•©ë‹ˆë‹¤. (ë¹„ë°€: ë‹¹ì‹ ì€ í”¼í•´ìì—ê²Œ ì¹˜ëª…ì ì¸ ì•½ë¬¼ì„ ì²˜ë°©í•´ë‹¬ë¼ëŠ” í˜‘ë°•ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.)",
                password: "pass3" // (â˜…) ì‹¤ì œ ê²Œì„ ë°°í¬ ì‹œ ì´ ì•”í˜¸ë¥¼ ë³€ê²½í•˜ì„¸ìš”.
            },
            "íƒì •": {
                alibi: "ë‹¹ì‹ ì€ í”¼í•´ìì˜ ì˜ë¢°ë¥¼ ë°›ê³  ì €íƒì— ì˜¨ íƒì •ì…ë‹ˆë‹¤. ë‹¹ì‹ ì€ 'í”¼í•´ìê°€ ëˆ„êµ°ê°€ ìì‹ ì„ ìœ„í˜‘í•œë‹¤ê³  í•˜ì—¬ ì¡°ì‚¬ë¥¼ ì‹œì‘í–ˆë‹¤'ê³  ì¦ì–¸í•´ì•¼ í•©ë‹ˆë‹¤. (ë¹„ë°€: ë‹¹ì‹ ì€ ë²”ì¸ì„ ëª©ê²©í–ˆì§€ë§Œ, ë„ˆë¬´ ì–´ë‘ì›Œ ëˆ„êµ°ì§€ ì‹ë³„í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.)",
                password: "pass4" // (â˜…) ì‹¤ì œ ê²Œì„ ë°°í¬ ì‹œ ì´ ì•”í˜¸ë¥¼ ë³€ê²½í•˜ì„¸ìš”.
            }
        };
        const ROLES = Object.keys(ROLE_DATA);

        // (â˜…) ì¶”ê°€: í˜ì´ì¦ˆ ë° íƒ€ì´ë¨¸ ì„¤ì •
        const PHASES = [
            { name: "1ì°¨ ì¡°ì‚¬", duration: 20 * 60 }, // 1200 seconds (20ë¶„)
            { name: "2ì°¨ ì¡°ì‚¬", duration: 10 * 60 }, // 600 seconds (10ë¶„)
            { name: "ìµœì¢… ì¡°ì‚¬", duration: 2 * 60 }  // 120 seconds (2ë¶„)
        ];
        let currentPhaseIndex = 0;
        let timerSeconds = 0;
        let timerInterval = null;
        let isInvestigationActive = false; // (â˜…) ì¡°ì‘ ì ê¸ˆ(lock) ë³€ìˆ˜

        // --- ë¡œì»¬ ë°ì´í„° ì €ì¥ í‚¤ ---
        const LOCAL_STORAGE_KEY = 'suspectsGame_offline_playerData';

        // --- í”Œë ˆì´ì–´ ë°ì´í„° (Firebase DB ëŒ€ì‹  ì‚¬ìš©) ---
        let myPlayerData = {
            name: "",
            role: "",
            alibi: "",
            collectedPhotos: []
        };

        // --- UI ìš”ì†Œ ---
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const playerNameInput = document.getElementById('player-name-input');
        const roleSelect = document.getElementById('role-select');
        const rolePasswordInput = document.getElementById('role-password-input'); // (â˜…) ì¶”ê°€
        const startGameBtn = document.getElementById('start-game-btn');

        const displayPlayerName = document.getElementById('display-player-name');
        const roomContainer = document.getElementById('room-container');
        
        const clueModal = document.getElementById('clue-modal');
        const galleryModal = document.getElementById('gallery-modal');
        const myInfoModal = document.getElementById('my-info-modal');
        const takePhotoBtn = document.getElementById('take-photo-btn');
        const flashOverlay = document.getElementById('flash-overlay');
        
        const alertModal = document.getElementById('alert-modal');
        const alertTitle = document.getElementById('alert-title');
        const alertMessage = document.getElementById('alert-message');
        const alertCloseBtn = document.getElementById('alert-close-btn');

        // (â˜…) ì¶”ê°€: í˜ì´ì¦ˆ ë° íƒ€ì´ë¨¸ UI ìš”ì†Œ
        const timerDisplay = document.getElementById('timer-display');
        const phaseModal = document.getElementById('phase-modal');
        const phaseTitle = document.getElementById('phase-title');
        const phaseDesc = document.getElementById('phase-desc');
        const startPhaseBtn = document.getElementById('start-phase-btn');

        // --- í•µì‹¬ ë¡œì§ ---

        // (â˜…) ì•Œë¦¼ ëª¨ë‹¬ í•¨ìˆ˜ (ë™ì¼)
        function showNotification(message, title = "ì•Œë¦¼") {
            console.warn("Notification:", message);
            alertTitle.textContent = title;
            alertMessage.textContent = message;
            alertModal.classList.remove('hidden');
        }

        // 1. ê²Œì„ ì´ˆê¸°í™” (Firebase ì¸ì¦ ëŒ€ì‹ )
        function initializeGame() {
            // ì—­í•  ì„ íƒ ì˜µì…˜ ì±„ìš°ê¸°
            ROLES.forEach(roleName => {
                const option = document.createElement('option');
                option.value = roleName;
                option.textContent = roleName;
                roleSelect.appendChild(option);
            });

            // (â˜…) ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹œë„
            const savedData = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (savedData) {
                myPlayerData = JSON.parse(savedData);
                console.log("ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜´:", myPlayerData);
                // ì €ì¥ëœ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë°”ë¡œ ê²Œì„ í™”ë©´ìœ¼ë¡œ
                startGame();
            } else {
                // ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì‹œì‘ í™”ë©´ í‘œì‹œ
                startScreen.style.display = 'block';
            }
        }

        // 2. ê²Œì„ ì‹œì‘
        function startGame() {
            // ì‹œì‘ í™”ë©´ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê±°ë‚˜, ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ì´ë¯¸ ë¡œë“œë¨
            if (startScreen.style.display !== 'none') {
                const playerName = playerNameInput.value;
                const selectedRole = roleSelect.value;
                const enteredPassword = rolePasswordInput.value; // (â˜…) ì¶”ê°€

                if (!playerName || !selectedRole) {
                    showNotification("ì´ë¦„ê³¼ ì—­í• ì„ ëª¨ë‘ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.");
                    return;
                }
                
                if (!enteredPassword) { // (â˜…) ì¶”ê°€
                    showNotification("ì—­í• ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
                    return;
                }

                // (â˜…) ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ë¡œì§
                if (ROLE_DATA[selectedRole] && ROLE_DATA[selectedRole].password === enteredPassword) {
                    // ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜
                    myPlayerData.name = playerName;
                    myPlayerData.role = selectedRole;
                    myPlayerData.alibi = ROLE_DATA[selectedRole].alibi; // (â˜…) ìˆ˜ì •: alibi ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    // collectedPhotosëŠ” ê¸°ë³¸ê°’ [] ìœ ì§€
                    
                    // (â˜…) ìƒˆ ë°ì´í„°ë¥¼ ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥
                    savePlayerData();
                } else {
                    // ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜
                    showNotification("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.", "ì¸ì¦ ì‹¤íŒ¨");
                    return;
                }
            }
            
            // UI ì—…ë°ì´íŠ¸
            displayPlayerName.textContent = myPlayerData.name;
            document.getElementById('my-role').textContent = myPlayerData.role;
            document.getElementById('my-alibi').textContent = myPlayerData.alibi;

            // í™”ë©´ ì „í™˜
            startScreen.style.display = 'none';
            gameScreen.classList.remove("hidden");

            // (â˜…) ìˆ˜ì •: ê²Œì„ í™”ë©´ì„ ë°”ë¡œ ë³´ì—¬ì£¼ëŠ” ëŒ€ì‹ , í˜ì´ì¦ˆ ì‹œì‘ íŒì—…ì„ ë„ì›ë‹ˆë‹¤.
            showPhasePopup();
        }

        // (â˜…) í”Œë ˆì´ì–´ ë°ì´í„°ë¥¼ ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥
        function savePlayerData() {
            try {
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(myPlayerData));
                console.log("ë°ì´í„° ì €ì¥ë¨:", myPlayerData);
            } catch (e) {
                console.error("ë¡œì»¬ ì €ì¥ì†Œ ì €ì¥ ì˜¤ë¥˜:", e);
                showNotification("ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •(ì¿ í‚¤/ë¡œì»¬ ì €ì¥ì†Œ)ì„ í™•ì¸í•˜ì„¸ìš”.", "ì˜¤ë¥˜");
            }
        }

        // 3. ë‹¨ì„œ ì¡°ì‚¬ (í•«ìŠ¤íŒŸ í´ë¦­)
        function handleHotspotClick(e) {
            // (â˜…) ì¶”ê°€: ì¡°ì‚¬ ì ê¸ˆ í™•ì¸
            if (!isInvestigationActive) {
                showNotification("ì¡°ì‚¬ ì‹œê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. 'ë‚´ ë¹„ë°€ì •ë³´'ë‚˜ 'ì‚¬ì§„ì²©'ë§Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.", "ì¡°ì‚¬ ë¶ˆê°€");
                return;
            }

            const target = e.target.closest('.clue-hotspot');
            if (!target) return;
            
            const clueId = target.dataset.clue;
            if (CLUE_DEFINITIONS[clueId]) {
                const clueData = CLUE_DEFINITIONS[clueId];
                
                document.getElementById('clue-title').textContent = clueData.name;
                document.getElementById('clue-image').src = clueData.img;
                document.getElementById('clue-desc').textContent = clueData.desc;
                
                takePhotoBtn.dataset.clueId = clueId;

                // (â˜…) ë¡œì»¬ ë°ì´í„°(myPlayerData) ê¸°ì¤€
                if (myPlayerData.collectedPhotos.includes(clueId)) {
                    takePhotoBtn.textContent = "âœ” ì´ë¯¸ ìˆ˜ì§‘í•¨";
                    takePhotoBtn.disabled = true;
                    takePhotoBtn.classList.replace("bg-green-600", "bg-gray-500");
                    takePhotoBtn.classList.remove("hover:bg-green-700");
                } else {
                    takePhotoBtn.textContent = "ğŸ“¸ ì‚¬ì§„ ì°ê¸°";
                    takePhotoBtn.disabled = false;
                    takePhotoBtn.classList.replace("bg-gray-500", "bg-green-600");
                    takePhotoBtn.classList.add("hover:bg-green-700");
                }
                
                clueModal.classList.remove("hidden");
            }
        }

        // 4. (â˜…) ì‚¬ì§„ ì°ê¸° (ì¦ê±° ìˆ˜ì§‘)
        function takePhoto() {
            const clueId = takePhotoBtn.dataset.clueId;
            if (!clueId) return;

            flashOverlay.classList.add("flash");
            setTimeout(() => {
                flashOverlay.classList.remove("flash");
            }, 150);
            
            // (â˜…) Firestore ëŒ€ì‹  ë¡œì»¬ ê°ì²´ì™€ ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥
            if (!myPlayerData.collectedPhotos.includes(clueId)) {
                myPlayerData.collectedPhotos.push(clueId); // 1. ë¡œì»¬ ê°ì²´ ì—…ë°ì´íŠ¸
                savePlayerData(); // 2. ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥
                
                console.log(`ì¦ê±° ìˆ˜ì§‘ ì„±ê³µ: ${clueId}`);
                
                clueModal.classList.add("hidden");
                showGallery(); // ì‚¬ì§„ì²© ë°”ë¡œ ì—´ê¸°
            }
        }

        // 5. ì‚¬ì§„ì²© ë³´ê¸° (ë™ì¼)
        function showGallery() {
            const grid = document.getElementById('gallery-grid');
            const emptyMsg = document.getElementById('gallery-empty');
            grid.innerHTML = ""; // (â˜…) ì´ì œ 'gallery-empty'ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤.
            
            if (myPlayerData.collectedPhotos && myPlayerData.collectedPhotos.length > 0) {
                emptyMsg.classList.add("hidden"); // ì‚¬ì§„ì´ ìˆìœ¼ë‹ˆ ë©”ì‹œì§€ ìˆ¨ê¹€
                
                myPlayerData.collectedPhotos.forEach(clueId => {
                    const clueData = CLUE_DEFINITIONS[clueId];
                    if (clueData) {
                        const photoEl = document.createElement("div");
                        photoEl.className = "gallery-photo p-3";
                        photoEl.innerHTML = `
                            <img src="${clueData.img}" alt="${clueData.name}" class="w-full h-32 object-cover rounded-md mb-2">
                            <h4 class="font-bold text-lg">${clueData.name}</h4>
                            <p class="text-sm text-gray-300">${clueData.desc.substring(0, 50)}...</p>
                        `;
                        grid.appendChild(photoEl);
                    }
                });
            } else {
                emptyMsg.classList.remove("hidden"); // ì‚¬ì§„ì´ ì—†ìœ¼ë‹ˆ ë©”ì‹œì§€ í‘œì‹œ
            }
            
            galleryModal.classList.remove("hidden");
        }

        // (â˜…) ì¶”ê°€: 6. í˜ì´ì¦ˆ ë° íƒ€ì´ë¨¸ ê´€ë ¨ í•¨ìˆ˜
        
        // í˜ì´ì¦ˆ ì‹œì‘ íŒì—… í‘œì‹œ
        function showPhasePopup() {
            isInvestigationActive = false; // íŒì—…ì´ ë–  ìˆëŠ” ë™ì•ˆ ì¡°ì‚¬ ë¶ˆê°€
            if (timerInterval) clearInterval(timerInterval);

            if (currentPhaseIndex < PHASES.length) {
                const phase = PHASES[currentPhaseIndex];
                phaseTitle.textContent = `${phase.name} ì‹œì‘`;
                phaseDesc.textContent = `ì œí•œ ì‹œê°„ì€ ${phase.duration / 60}ë¶„ì…ë‹ˆë‹¤. ì¤€ë¹„ë˜ë©´ 'ì¡°ì‚¬ ì‹œì‘' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.`;
                phaseModal.classList.remove("hidden");
            } else {
                // ëª¨ë“  í˜ì´ì¦ˆ ì¢…ë£Œ
                endGame();
            }
        }

        // í˜ì´ì¦ˆ ì‹œì‘ (íŒì—… ë²„íŠ¼ í´ë¦­ ì‹œ)
        function startPhase() {
            const phase = PHASES[currentPhaseIndex];
            timerSeconds = phase.duration;
            updateTimerDisplay();
            
            phaseModal.classList.add("hidden");
            
            startTimer();
        }

        // íƒ€ì´ë¨¸ ì‹œì‘
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            isInvestigationActive = true; // (â˜…) ì¡°ì‚¬ ê°€ëŠ¥ ìƒíƒœ

            timerInterval = setInterval(() => {
                timerSeconds--;
                updateTimerDisplay();

                if (timerSeconds <= 0) {
                    endPhase();
                }
            }, 1000); // 1ì´ˆë§ˆë‹¤
        }

        // íƒ€ì´ë¨¸ ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸
        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // í˜ì´ì¦ˆ ì¢…ë£Œ
        function endPhase() {
            if (timerInterval) clearInterval(timerInterval);
            isInvestigationActive = false; // (â˜…) ì¡°ì‚¬ ë¶ˆê°€ëŠ¥ ìƒíƒœ
            
            const phase = PHASES[currentPhaseIndex];
            showNotification(`${phase.name}ì´(ê°€) ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`, "ì‹œê°„ ì¢…ë£Œ");
            
            currentPhaseIndex++;
            
            // 2ì´ˆ í›„ ë‹¤ìŒ í˜ì´ì¦ˆ íŒì—… í‘œì‹œ
            setTimeout(showPhasePopup, 2000);
        }

        // ê²Œì„ (ëª¨ë“  í˜ì´ì¦ˆ) ì¢…ë£Œ
        function endGame() {
            isInvestigationActive = false;
            if (timerInterval) clearInterval(timerInterval);
            timerDisplay.textContent = "ì¢…ë£Œ";
            showNotification("ëª¨ë“  ì¡°ì‚¬ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìˆ˜ì§‘í•œ ì¦ê±°ë¥¼ ë°”íƒ•ìœ¼ë¡œ í† ë¡ ì„ ì‹œì‘í•˜ì„¸ìš”.", "ê²Œì„ ì˜¤ë²„");
        }


        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
        window.addEventListener('load', initializeGame); // (â˜…)
        
        startGameBtn.addEventListener('click', startGame); // (â˜…)
        
        roomContainer.addEventListener('click', handleHotspotClick);
        takePhotoBtn.addEventListener('click', takePhoto);
        
        document.querySelectorAll('[data-close]').forEach(btn => {
            btn.addEventListener('click', () => {
                const modalId = btn.dataset.close;
                document.getElementById(modalId).classList.add("hidden");
            });
        });
        
        alertCloseBtn.addEventListener('click', () => {
            alertModal.classList.add('hidden');
        });

        document.getElementById('gallery-btn').addEventListener('click', showGallery);
        document.getElementById('my-info-btn').addEventListener('click', () => {
            myInfoModal.classList.remove("hidden");
        });
        
        // (â˜…) ì‚­ì œ: vote-btn ë¦¬ìŠ¤ë„ˆ
        /*
        document.getElementById('vote-btn').addEventListener('click', () => {
            showNotification("ë²”ì¸ íˆ¬í‘œ ê¸°ëŠ¥ì€ ì•„ì§ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤. ìˆ˜ì§‘í•œ ì¦ê±°ë¥¼ ë°”íƒ•ìœ¼ë¡œ í† ë¡ í•´ë³´ì„¸ìš”!");
        });
        */

        // (â˜…) ì¶”ê°€: í˜ì´ì¦ˆ ì‹œì‘ ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆ
        startPhaseBtn.addEventListener('click', startPhase);

    </script>
</body>
</html>